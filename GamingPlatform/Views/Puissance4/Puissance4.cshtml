@{
    ViewData["Title"] = "Puissance 4";
}

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>
    <link rel="stylesheet" href="/css/game.css" />
    <style>
        body {
            background-color: #2c3e50; /* Fond sombre */
            color: #ecf0f1; /* Texte clair */
        }

        h1 {
            text-align: center;
            color: #ecf0f1;
            margin-top: 20px;
        }

        #currentPlayer {
            text-align: center;
            font-size: 1.5em;
            margin: 20px 0;
        }

        #gameBoard {
            margin: 0 auto;
            border: 3px solid #ecf0f1;
            border-radius: 10px;
        }

        #gameBoard td {
            width: 50px;
            height: 50px;
            text-align: center;
            background-color: #34495e; /* Fond des cases de jeu */
            cursor: pointer;
        }

        #gameBoard td.Rouge {
            background-color: red;
        }

        #gameBoard td.Jaune {
            background-color: yellow;
        }

        #gameBoard td:hover {
            background-color: #2c3e50;
        }

        #playerNames {
            display: none;
        }

        .btn {
            background-color: #e74c3c;
            border-color: #e74c3c;
            color: #ecf0f1;
        }

        .btn:hover {
            background-color: #c0392b;
            border-color: #c0392b;
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <h1>Puissance 4</h1>
        <p id="currentPlayer">Joueur : ðŸ”´</p>
        <p id="playerNames" style="display: none;"></p> <!-- Section cachÃ©e pour stocker les noms -->

        <table id="gameBoard" border="1" style="border-collapse: collapse;"></table>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.4/signalr.min.js"></script>
        <script src="/js/game.js"></script>

        <script>
            // Initialisation de SignalR
            const connection = new signalR.HubConnectionBuilder().withUrl("/lobbyHub").build();

            // RÃ©cupÃ©rer les noms des joueurs et mettre Ã  jour l'affichage
            connection.on("UpdatePlayers", (player1, player2) => {
                const playerNamesElement = document.getElementById("playerNames");
                playerNamesElement.textContent = `ðŸ”´ ${player1}, ðŸŸ¡ ${player2}`;
                console.log(`Joueurs : ${player1} (ðŸ”´) et ${player2} (ðŸŸ¡)`);
            });

            // Mettre Ã  jour le plateau de jeu et le joueur actuel
            connection.on("UpdateBoard", (board, currentPlayer) => {
                renderBoard(board);
                const currentPlayerElement = document.getElementById("currentPlayer");
                currentPlayerElement.textContent = `Joueur : ${currentPlayer === "Player1" ? "ðŸ”´" : "ðŸŸ¡"}`;
            });

            // Connexion SignalR
            connection.start().then(() => {
                console.log("ConnectÃ© au hub SignalR.");
                connection.invoke("JoinGame", "@ViewBag.LobbyName", "@ViewBag.PlayerName");
            }).catch(err => console.error("Erreur de connexion SignalR :", err));

            // Fonction de rendu du plateau de jeu
            function renderBoard(board) {
                const gameBoard = document.getElementById("gameBoard");
                gameBoard.innerHTML = ""; // RÃ©initialiser le tableau

                board.forEach((row, rowIndex) => {
                    const tr = document.createElement("tr");
                    row.forEach((cell, colIndex) => {
                        const td = document.createElement("td");
                        td.style.width = "50px";
                        td.style.height = "50px";
                        td.style.textAlign = "center";
                        td.classList.add(cell); // Applique les classes Rouge ou Jaune en fonction de la cellule
                        td.dataset.column = colIndex;
                        td.addEventListener("click", () => makeMove(colIndex));
                        tr.appendChild(td);
                    });
                    gameBoard.appendChild(tr);
                });
            }

            // Fonction pour effectuer un mouvement
            function makeMove(column) {
                connection.invoke("MakeMove", "@ViewBag.LobbyName", column, "@ViewBag.PlayerName")
                    .catch(err => console.error("Erreur lors du coup :", err));
            }
        </script>
        <script>
    function googleTranslateElementInit() {
        new google.translate.TranslateElement(
            { pageLanguage: 'fr' },
            'google_translate_element'
        );
    }
    </script>
    <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
    </div>
</body>
</html>

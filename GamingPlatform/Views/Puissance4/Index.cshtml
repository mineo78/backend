@{
    ViewData["Title"] = "Accueil";
}

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #2c3e50; /* Fond sombre */
            color: #ecf0f1; /* Texte clair */
        }

        .card {
            background-color: #34495e; /* Fond des cartes */
            color: #ecf0f1; /* Texte des cartes */
        }

        .btn-primary {
            background-color: #e74c3c; /* Couleur des boutons principaux */
            border-color: #e74c3c;
        }

        .btn-primary:hover {
            background-color: #c0392b; /* Hover du bouton */
            border-color: #c0392b;
        }

        .form-control {
            background-color: #2c3e50; /* Fond des champs de formulaire */
            color: #ecf0f1; /* Texte des champs */
            border-color: #34495e; /* Bordure des champs */
        }

        .form-control:focus {
            background-color: #2c3e50; /* Fond lors de la mise au focus */
            color: #ecf0f1; /* Texte lors du focus */
            border-color: #e74c3c; /* Bordure lors du focus */
        }

        .text-danger {
            color: #e74c3c !important; /* Couleur du texte d'erreur */
        }

        .list-group-item {
            background-color: #34495e; /* Fond des items de la liste */
            color: #ecf0f1; /* Texte des items */
        }

        .list-group-item:hover {
            background-color: #2c3e50; /* Hover sur les items de la liste */
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <!-- Title -->
        <div class="text-center mb-5">
            <h1 class="display-4">Créer ou rejoindre un lobby</h1>
            <p class="lead">Entrez vos informations pour rejoindre ou créer un lobby.</p>
        </div>

        <!-- Form to create a new lobby -->
        <div class="mb-4">
            <label for="playerName" class="form-label">Entrez votre pseudo :</label>
            <input type="text" id="playerName" class="form-control" placeholder="Votre pseudo" />
        </div>

        <div class="mb-4">
            <label for="lobbyName" class="form-label">Entrez le nom du lobby :</label>
            <input type="text" id="lobbyName" class="form-control" placeholder="Nom du lobby" />
        </div>

        <div class="d-grid gap-2 mb-4">
            <button id="createLobbyButton" class="btn btn-primary">
                Créer un lobby
            </button>
        </div>

        <h2 class="text-center mt-5">Liste des lobbys disponibles</h2>

        <div class="d-flex justify-content-center mb-4">
            <button id="refreshLobbies" class="btn btn-secondary">
                Rafraîchir la liste des lobbys
            </button>
        </div>

        <ul id="lobbyList" class="list-group">
            <!-- La liste des lobbys sera affichée ici -->
        </ul>
    </div>

    <script src="/js/signalr/dist/browser/signalr.js"></script>
    <script>
        const connection = new signalR.HubConnectionBuilder().withUrl("/lobbyHub").build();

        connection.start().then(() => {
            console.log("Connexion SignalR établie.");
            connection.invoke("GetLobbies").then(updateLobbyList);
        }).catch(err => console.error("Erreur de connexion SignalR :", err));

        // Fonction pour mettre à jour la liste des lobbys
        function updateLobbyList(lobbies) {
            const lobbyList = document.getElementById("lobbyList");
            lobbyList.innerHTML = "";

            if (!lobbies || lobbies.length === 0) {
                lobbyList.innerHTML = "<li class='list-group-item'>Aucun lobby disponible</li>";
                return;
            }

            lobbies.forEach(lobby => {
                const li = document.createElement("li");
                li.classList.add("list-group-item", "d-flex", "justify-content-between", "align-items-center");
                li.textContent = `${lobby.name} (${lobby.players.length}/2 joueurs)`;

                // Ajouter un bouton pour rejoindre le lobby
                const joinButton = document.createElement("button");
                joinButton.classList.add("btn", "btn-sm", "btn-success");
                joinButton.textContent = "Rejoindre";
                joinButton.addEventListener("click", () => {
                    const playerName = document.getElementById("playerName").value;
                    if (!playerName) {
                        alert("Entrez un pseudo pour rejoindre !");
                        return;
                    }
                    connection.invoke("JoinLobby", lobby.name, playerName)
                        .catch(err => console.error("Erreur lors de la tentative de rejoindre :", err));
                });

                li.appendChild(joinButton);
                lobbyList.appendChild(li);
            });
        }

        // Créer un lobby
        document.getElementById("createLobbyButton").addEventListener("click", () => {
            const playerName = document.getElementById("playerName").value;
            const lobbyName = document.getElementById("lobbyName").value;

            if (!playerName || !lobbyName) {
                alert("Veuillez entrer un pseudo et un nom de lobby !");
                return;
            }

            connection.invoke("CreateLobby", lobbyName, playerName);
        });

        // Rafraîchir la liste des lobbys
        document.getElementById("refreshLobbies").addEventListener("click", () => {
            connection.invoke("GetLobbies")
                .then(updateLobbyList)
                .catch(err => console.error("Erreur lors de la récupération des lobbys :", err));
        });

        connection.on("UpdateLobbyList", (lobbies) => {
            console.log("Lobbys mis à jour :", lobbies);
            updateLobbyList(lobbies); // Mettre à jour l'affichage
        });

        connection.on("GameReady", (lobbyName) => {
            alert("Le jeu est prêt !");
            window.location.href = `/Puissance4/Puissance4?lobby=${lobbyName}`;
        });

        connection.on("Error", (message) => {
            alert(message);
        });
    </script>
    <script>
    function googleTranslateElementInit() {
        new google.translate.TranslateElement(
            { pageLanguage: 'fr' },
            'google_translate_element'
        );
    }
</script>
<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</body>
</html>
